<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script src="scripts/hello-world.js"></script>
        <script type="text/javascript" src="http://jplayer.org/2.1.0/js/jquery.jplayer.min.js"></script>
        

        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
        <link href="http://jplayer.org/latest/skin/blue.monday/jplayer.blue.monday.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <script id="template" type="text/x-kendo-template">
          <div>
            <a href="javascript:;" id="play"><input type="button" value="Play"/></a>
            <a href="javascript:;" id="pause"><input type="button" value="Pause"/></a>
            <div id="jquery_jplayer_1" class="jp-jplayer"></div>
          </div>
        </script>
        <div data-role="view" id="tabstrip-home" data-title="Page Communication">
            <h1>Welcome!</h1>
            <p>
                Short test to have two pages communicate with each other. 
                Select languages on the 'Selection' page, then press the button 
                on the 'Results' page to see your selections appear.
            </p>
        </div>

        <div data-role="layout" data-id="mobile-tabstrip">
            <header data-role="header">
                <div data-role="navbar">
                    <span data-role="view-title"></span>
                </div>
            </header>

            <div data-role="footer">
                <div data-role="tabstrip">
                    <a href="#tabstrip-home" data-icon="home">Home</a>
                    <a href="#tabstrip-checkbox" data-icon="settings">Selection</a>
                    <a href="#tabstrip-results" data-icon="play">Result</a>
                    <a href="#tabstrip-media" data-icon="pause">Media Page</a>
                </div>
            </div>
        </div>

        <!-- SELECT LANGUAGES -->
          <div data-role="view" id="tabstrip-checkbox" data-title="Select Languages:">
             <div data-role="fieldcontain">
                <fieldset data-role="controlgroup">
	               <legend>Select languages you would like displayed:</legend>
	               <label><input type="checkbox" name="English" id="en" value="en" />English</label><br/>
	               <label><input type="checkbox" name="French" id="fr" value="fr" />French</label><br/>
                   <label><input type="checkbox" name="Spanish" id="es" value="es"/>Spanish</label><br/>
                   <label><input type="checkbox" name="Russian" id="ru" value="ru"/>Russian</label><br/>
                   <label><input type="checkbox" name="German" id="de"  value="de"/>German</label><br/>
                   <label><input type="checkbox" name="Japanese" id="ja"  value="ja"/>Japanese</label><br/>
                   <label><input type="checkbox" name="Swedish" id="sv"  value="sv"/>Swedish</label><br/>
                   <label><input type="checkbox" name="Italian" id="it" value="it"/>Italian</label><br/>
                   <label><input type="checkbox" name="Mandarin Chinese" id="zh-Hans"  value="zh-Hans"/>Mandarin Chinese</label>
                </fieldset>
            </div>
            
          </div>
        
        <!-- RESULTS -->
        <div data-role="view" id="tabstrip-results">
            <input type="search" name="search-mini" id="wordSearch" value="How's it going?" data-mini="true" />
            <input type="button" id="resultButton" value="Translate!"/>
            <ul id="result" data-role="listview"></ul>
            <input type="button" id="ttsButton" value="Text-to-speech"/>
            <div id="ttsDiv"></div>
        </div>
        
        
        <div data-role="view" id="tabstrip-media" data-title="Page Communication">
            <h1>Welcome!</h1>
            <p>
                Short test to have two pages communicate with each other. 
                Select languages on the 'Selection' page, then press the button 
                on the 'Results' page to see your selections appear.
            </p>
            <div id="cant"></div>
        </div>
        
        
        <!-- SCRIPT -->
        <script>
            var defaultLang = "en";
            var t;
            var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "mobile-tabstrip" });
            var button = $("#resultButton").kendoMobileButton({icon: "stop"});
            
            $(document).ready(function() {
    //add from notepad++
});
            
            //button click event obtains access key then calls 'translateThis'
            $("#resultButton").click(function(){
                    //obtain access key
                    $.ajax({
                        url:'http://localhost:56789/api/accesstoken/',
                        success:(translateThis)
                    });
            });
                         
            function appendAnswers(response){             //this.name not working (no inside the loop)
                     $("#result").append("<li><div class=smallFont>"+this.name+
                "</div><div class=output>"+response+"</div></li>");
                
            }
                     
            function translateThis(admAuth){
                $("#result").empty();//empty out the result list
                $("fieldset input:checked").each(function(){
                    var to = this.value;
                    var text = $('#wordSearch').val();
                    var s = document.createElement("script");
                    s.src= "http://api.microsofttranslator.com/V2/Ajax.svc/Translate" +
                    "?appId=Bearer "+encodeURIComponent(admAuth.access_token)+
                    "&from=" + encodeURIComponent(defaultLang)+
                    "&to=" + encodeURIComponent(to)+
                    "&text=" + encodeURIComponent(text)+
                    "&oncomplete=appendAnswers";
                    document.body.appendChild(s);
                });
            }
            
	    function addTts(response) {
                    var t = kendo.template($("#template").html());

                    $("#ttsDiv").html(t);
                    //$("#ttsDiv").append('<a href="http://'+response+'.mp3">cliick</a>');

                    $("#jquery_jplayer_1").jPlayer({
                        ready: function(event) {
                        $(this).jPlayer("setMedia", {
                            mp3: response
                        });
                    },
                    swfPath: "http://www.jplayer.org/2.1.0/js",
                    supplied: "mp3",
                    cssSelectorAncestor: "",
                    cssSelector:{
                        play: "#play",
                        pause: "#pause"
                    }
                });
				
	    }        
                    
            //button click event translates text to speech (mp3)
            $("#ttsButton").click(function(){
                    var words = $('#wordSearch').val();
                    //ajax to tts-api.com
                    $.ajax({
                        url:'http://tts-api.com/tts.mp3?q='+words+'&return_url=1.',
                        //url:'http://api.ispeech.org/api/rest?apikey=developerdemokeydeveloperdemokey&action=convert&text='+words+'&voice=usenglishfemale',
                        success:(addTts)
                    });
            });        
        </script>
    </body>
</html>
