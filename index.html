<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script src="scripts/hello-world.js"></script>
        <script type="text/javascript" src="http://jplayer.org/2.1.0/js/jquery.jplayer.min.js"></script>
        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
        <link href="http://jplayer.org/latest/skin/blue.monday/jplayer.blue.monday.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div data-role="layout" data-id="mobile-tabstrip"><!-- layout -->
            <header data-role="header">
                <div data-role="navbar">
                    <span data-role="view-title"></span>
                </div>
            </header>

            <div data-role="footer">
                <div data-role="tabstrip">
                    <a href="#tabstrip-home" data-icon="home">Home</a>
                    <a href="#tabstrip-checkbox" data-icon="settings">Selection</a>
                    <a href="#tabstrip-results" data-icon="play">Result</a>
                </div>
            </div>
        </div>
        
        <!-- MAIN VIEW -->
        <div data-role="view" id="tabstrip-home" data-title="Vernaculate">
            <h1>Welcome!</h1>
            <p>
                Select languages and then translate your custom sentences! 
            </p>
        </div>

        <!-- SELECT LANGUAGES -->
          <div data-role="view" id="tabstrip-checkbox" data-title="Select Languages:">
             <div data-role="fieldcontain">
                <fieldset data-role="controlgroup">
	               <legend>Select languages you would like displayed:</legend>
	               <label><input type="checkbox" name="English" id="en" value="en" />English</label><br/>
	               <label><input type="checkbox" name="French" id="fr" value="fr" />French</label><br/>
                   <label><input type="checkbox" name="Spanish" id="es" value="es"/>Spanish</label><br/>
                   <label><input type="checkbox" name="Italian" id="pt" value="pt"/>Portuguese</label><br/>
                   <label><input type="checkbox" name="Italian" id="it" value="it"/>Italian</label><br/>
                   <label><input type="checkbox" name="German" id="de" value="de"/>German</label><br/>
                   <label><input type="checkbox" name="Swedish" id="sv" value="sv"/>Swedish</label><br/>
                   <label><input type="checkbox" name="Italian" id="nl" value="nl"/>Dutch</label><br/>
                   <label><input type="checkbox" name="Russian" id="ru" value="ru"/>Russian</label><br/>
                   <label><input type="checkbox" name="Italian" id="bg" value="bg"/>Bulgarian</label><br/>
                   <label><input type="checkbox" name="Italian" id="tr" value="tr"/>Turkish</label><br/>
                   <label><input type="checkbox" name="Italian" id="ar" value="ar"/>Arabic</label><br/>
                   <label><input type="checkbox" name="Italian" id="hi" value="hi"/>Hindi</label><br/>
                   <label><input type="checkbox" name="Japanese" id="ja" value="ja"/>Japanese</label><br/>
                   <label><input type="checkbox" name="Italian" id="ko" value="ko"/>Korean</label><br/>
                   <label><input type="checkbox" name="Mandarin Chinese" id="zh-Hans"  value="zh-Hans"/>Mandarin Chinese</label>
                </fieldset>
            </div>
            
          </div>
        
        <!-- RESULTS -->
        <div data-role="view" id="tabstrip-results">
            <input type="search" name="search-mini" id="wordSearch" value="Enter your phrase here..." data-mini="true" style="width:230px"/>
            <input type="button" id="resultButton" value="Translate!"/>
            
            <ul id="translated" data-role="listview"></ul><!--this is where all phrases end up-->
            
            <input type="button" id="ttsButton" value="Text-to-speech"/>
            <div id="ttsDiv"></div><!--text-to-speech result-->
        </div>
        
        <!-- WORD VIEW -->
        <div data-role="view" id="tabstrip-word-breakdown" data-title="Vernaculate" data-init="temp">
            <h1>Welcome!</h1>
            <p>
                WORD WORD WORD DEFINITION !
            </p>
        </div>
        
        
        
        <!-- MODAL VIEW template -->
        <div data-role="modalview" id="modal1" data-open="logTarget" style="width:250px; height:300px">
            <div id="modalText"></div><br/>     
            <input type="button" value="Close" id="closeModal"/><br/>
        </div>
        
        <!-- JAVASCRIPT -->
        <script>
            
            var defaultLang = "en";
            var modalTemplate;
            var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "mobile-tabstrip" });
            var button = $("#resultButton").kendoMobileButton({icon: "stop"});
            var phraseArr = [];  //array holding temp translated phrases
            var phraseIndex;     //var to hold index of each phrase
            
            /////////  TRANSLATE METHODS ///////////
            
            //button click event
            //main 'translate' function; checks 'checked' checkboxes, then 
            //calls my TranslationAPI to do the translation
            $("#resultButton").click(function(){
                $("#translated").empty(); //empty out the result list
                phraseArr.length = 0; //empty out the temp phrase list
                phraseIndex = -1;
                $("fieldset input:checked").each(function(){
                    var to = this.value;
                    var text = $('#wordSearch').val();
                    //JSON object being sent; untranslated
                    var untranslated = {"value":text, "lang":to};
                    $.ajax({
                      type: "POST",
                      dataType: "json",
                      contentType: "application/json",
                      data: JSON.stringify(untranslated),
                      url:"http://localhost:64600/api/translate",
                      success:function(response){   
                         phraseIndex+=1;
                         phraseArr[phraseIndex]=response;
                         $("#translated").append('<li><div class=t-output><a data-role="button"'+
                               'href="#modal1" data-rel="modalview">'+response+'</a></div></li>');
                
                       }
                    });
                });
            });
                  
            ///////////TEXT - TO - SPEECH //////////////
                        
            //button click event translates text to speech (mp3)
            $("#ttsButton").click(function(){
                    var words = $('#wordSearch').val();
                    //ajax to tts-api.com
                    $.ajax({
                        url:'http://tts-api.com/tts.mp3?q='+words+'&return_url=1.',
                        success:(addTts)
                    });
                        //another api, has support for multiple languages, but costs $$$
                        //url:'http://api.ispeech.org/api/rest?apikey=developerdemokey
                        //developerdemokey&action=convert&text='+words+'&voice=usenglishfemale',  
            });   
            
            //adds the 'play' button below the 'text-to-speech' button
            function addTts(response) {
                    jPlayerTemplate = kendo.template($("#template").html());
                    $("#ttsDiv").html(jPlayerTemplate);
                    $("#jquery_jplayer_1").jPlayer({
                        ready: function(event) {
                            $(this).jPlayer("setMedia", {
                               mp3: response
                            });
                        },
                        swfPath: "http://www.jplayer.org/2.1.0/js",
                        supplied: "mp3",
                        cssSelectorAncestor: "",
                        cssSelector:{
                        play: "#play",
                        pause: "#pause"
                    }
                });
			}
                        
            ///////// MODAL VIEW FUNCTIONS ////////////////
                
            //temporarily unused 'close' button; function below closes modal view when the view 
            //is clicked or when anything inside the view is clicked.
            /*$("#closeModal").click(function(){
                var modal = $("#modal1").data("kendoMobileModalView");
                modal.close();
                //modal.destroy();
            });*/
            $('#modal1').click(function(){
                    var modal2 = $("#modal1").data("kendoMobileModalView");
                    modal2.close();
            }); 
                       
            //finds the phrase that was clicked on to open the modal 
            //view, then parses the phrase to display each words 'definition'
            function logTarget(e){
                var phrase = e.target.text();
                var wordArr = phrase.split(' ');
                 $("#modalText").empty();
                 $("#modalText").append('<ul id="translatedWords" data-role="listview"></ul>');
                for(i=0; i < wordArr.length; i++){
                    //each word in here
                         $("#translatedWords").append('<li><div class="sum" style="font-size:1.6em"><a data-role="button" data-click="temp">'+
                                             wordArr[i]+'<br/>');
                    
                    
                    $("#translatedWords").append('"definition here"</a></div></li>');
                }       
                         
                //$("#modalText").empty();
                //$("#modalText").append('<div style="font-size:1.6em">'+e.target.text()+'</div>');
            }
        </script>
        
        <!-- the minimum possible for a working jPlayer -->
        <script id="template" type="text/x-kendo-template">
          <div>
            <a href="javascript:;" id="play"><input type="button" value="Play"/></a>
            <a href="javascript:;" id="pause"><input type="button" value="Pause"/></a>
            <div id="jquery_jplayer_1" class="jp-jplayer"></div>
          </div>
        </script>
    </body>
</html>
