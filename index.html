<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script src="scripts/hello-world.js"></script>
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
    </head>
    <body>
        <div data-role="view" id="tabstrip-home">
            <h1 style="text-align:center">Welcome to Vernaculate</h1>
            <p>
                Vernaculate allows you to translate phrases into multiple languages at once, 
                enabling you to compare the sounds and structure of each specific language.
            </p><div>
            <a class="menuButtons" data-role="button" href="">Select Default Language</a><br/>
            <a class="menuButtons" data-role="button" href="">Settings</a><br/>
            <a class="menuButtons" data-role="button" href="">About</a><br/></div>
            
        </div>

        <div data-role="view" id="tab-vernaculate">
            <div data-role="header">
                <div data-role="navbar">
                    <a data-role="button" data-align="left" data-icon="globe"
                       data-rel="popover" href="#pop-langs" style="padding:-25px;">èªž</a>
                  <input type="text" style="width: 11em; height: 30px; padding:2px;" 
                  value="Enter your phrase here" data-align="left" id="wordSearch"/>
                  <a data-role="button" data-align="right" id="searchButton">Search</a>
                </div>
            </div>
            
            <ul id="translated" data-role="listview" data-type="group">
                <h2>Try translating above !</h2>
                
            </ul><!--this is where all phrases end up-->
            
            <div id="pop-langs" data-role="popover"><!-- popover containing languages -->
                <div data-role="view">
                 <div data-role="fieldcontain">
                  <fieldset data-role="controlgroup">
	               <legend>Select languages you would like displayed:</legend>
                   <label><input type="checkbox" value="ar"/>Arabic</label><br/>
                   <label><input type="checkbox" value="bg"/>Bulgarian</label><br/>
                   <label><input type="checkbox" value="da"/>Danish</label><br/>   
                   <label><input type="checkbox" value="nl"/>Dutch</label><br/>
	               <label><input type="checkbox" value="en"/>English</label><br/>
	               <label><input type="checkbox" value="fr"/>French</label><br/>
                   <label><input type="checkbox" value="de"/>German</label><br/>
                   <label><input type="checkbox" value="hi"/>Hindi</label><br/>
                   <label><input type="checkbox" value="it"/>Italian</label><br/>
                   <label><input type="checkbox" value="ja"/>Japanese</label><br/>
                   <label><input type="checkbox" value="ko"/>Korean</label><br/>
                   <label><input type="checkbox" value="pt"/>Portuguese</label><br/>
                   <label><input type="checkbox" value="ru"/>Russian</label><br/>
                   <label><input type="checkbox" value="es"/>Spanish</label><br/>
                   <label><input type="checkbox" value="sv"/>Swedish</label><br/>
                   <label><input type="checkbox" value="th"/>Thai</label><br/>
                   <label><input type="checkbox" value="tr"/>Turkish</label><br/>
                  </fieldset>
                 </div>
                </div>
            </div>
        </div>

        
        <div data-role="layout" data-id="mobile-tabstrip">
            <div data-role="footer">
                <div data-role="tabstrip">
                    <a href="#tabstrip-home" data-icon="home">Home</a>
                    <a href="#tab-vernaculate" data-icon="globe">Vernaculate</a>
                </div>
            </div>
        </div>

        <!-- MODAL VIEW template -->
        <div data-role="modalview" id="modal1" data-open="logTarget" style="width:250px; height:300px">
            <div id="modalText"></div><br/>     
            <input type="button" value="Close" id="closeModal"/><br/>
        </div>
        
        <script>
            var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "mobile-tabstrip" });
            var phraseArr = [];  //array holding temp translated phrases
            var phraseIndex;     //var to hold index of each phrase
            var defaultLang = "en";
            var detectedLang;
            var modalTemplate;
            
            /////////  TRANSLATE METHODS ///////////
            
            //button click event
            //main 'translate' function; checks 'checked' checkboxes, then 
            //calls my TranslationAPI to do the translation
            $("#searchButton").click(function(){
                $("#translated").empty(); //empty out the result list
                phraseArr.length = 0; //empty out the temp phrase list
                phraseIndex = -1;
                $("fieldset input:checked").each(function(){
                    var to = this.value;
                    var text = $('#wordSearch').val();
                    //JSON object being sent; untranslated
                    var untranslated = {"value":text, "lang":to};
                    $.ajax({
                      type: "POST",
                      dataType: "json",
                      data: "{}",
                      contentType: "application/json",
                      data: JSON.stringify(untranslated),
                      url:"http://localhost:63388/api/translate/",
                      success:function(response){   
                         phraseIndex+=1;
                         phraseArr[phraseIndex]=response;
                         console.log("First word: "+phraseArr[phraseIndex].words[0].theWord);
                         $("#translated").append(
                             '<li><div style="background-color: rgba(120,155,200,0.5);"><p class="floatLeft">'+ response.langName
                            +'</p><p class="floatRight"><a class="appendedButton" href="#modal1" data-rel="modalview">define</a></p><div style="clear: both;">'
                            +'</div></div><div style="font-size:1.8em;">'+ response.value + '</div></li><br/>');
                         button = $(".appendedButton").kendoMobileButton(); 
                       }
                    });
                });
                           
            });
            
            
            
            
            
            ///////// MODAL VIEW FUNCTIONS ////////////////
            //temporarily unused 'close' button; function below closes modal view when the view 
            //is clicked or when anything inside the view is clicked.
            /*$("#closeModal").click(function(){
                var modal = $("#modal1").data("kendoMobileModalView");
                modal.close();
                //modal.destroy();
            });*/
            $('#modal1').click(function(){
                    var modal2 = $("#modal1").data("kendoMobileModalView");
                    modal2.close();
            }); 
                       
            //finds the phrase that was clicked on to open the modal 
            //view, then parses the phrase to display each words 'definition'
            function logTarget(e){
                var index = $('#translated li div a').index(e.target);
                console.log("thissss: "+index);
                $("#modalText").empty();
                $("#modalText").append('<ul id="translatedWords" data-role="listview"></ul>');
               
                          //phraseArr[phraseIndex].words[0].theWord
                          //THIS WILL NOT WORK with certain characters (ex. japanese) which don't have spaces between them.
                          for(i=0; i < phraseArr[index].words.length; i++){
                            //each word in here
                            $("#translatedWords").append('<li><div class="sum" style="font-size:1.6em">'+
                              '<a data-role="button" data-click="temp">'+phraseArr[index].words[i].theWord+'<br/>');
                            $("#translatedWords").append(phraseArr[index].words[i].definition+'</a></div></li>');
                          }
            }
        </script>
    </body>
</html>
